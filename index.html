<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sveriges Regioner â€” Geospatial FÃ¶rmÃ¥gekarta</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;1,9..40,300&display=swap');
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#f4f5f0;--bg-panel:#ffffff;--border:rgba(0,0,0,0.09);
  --text:#4a5568;--text-dim:#94a3b8;--text-bright:#1a202c;
  --accent:#2563eb;--accent-dim:#eff6ff;
  --d1:#db2777;--d1f:#fdf2f8;
  --d2:#0284c7;--d2f:#f0f9ff;
  --d3:#d97706;--d3f:#fffbeb;
  --d4:#059669;--d4f:#ecfdf5;
  --d5:#7c3aed;--d5f:#f5f3ff;
  --d6:#ea580c;--d6f:#fff7ed;
  --cap:#0891b2;--capf:#ecfeff;
  --proc:#6366f1;--procf:#eef2ff;
  --p-qw:#16a34a;--p-qwf:#f0fdf4;  /* quick win - green */
  --p-se:#2563eb;--p-sef:#eff6ff;  /* strategic - blue */
  --p-sf:#9333ea;--p-sff:#faf5ff;  /* system change - purple */
}
body{background:var(--bg);color:var(--text);font-family:'DM Sans',sans-serif;overflow:hidden;height:100vh;display:flex}
#canvas-wrap{flex:1;position:relative;cursor:grab;overflow:hidden}
#canvas-wrap.dragging{cursor:grabbing}
svg#viz{width:100%;height:100%;display:block;background:
  linear-gradient(rgba(0,0,0,0.025) 1px, transparent 1px),
  linear-gradient(90deg, rgba(0,0,0,0.025) 1px, transparent 1px);background-size:50px 50px}
@keyframes pulse-out{0%{r:4;opacity:.7}100%{r:80;opacity:0}}
.pulse-ring{animation:pulse-out 2.2s ease-out infinite;fill:none;stroke-width:2;pointer-events:none}
#panel{width:320px;min-width:270px;background:var(--bg-panel);border-left:1px solid var(--border);display:flex;flex-direction:column;overflow-y:auto;position:relative;z-index:10;box-shadow:-2px 0 12px rgba(0,0,0,0.04)}
.ps{padding:13px 16px 11px;border-bottom:1px solid var(--border);flex-shrink:0}
.ps:last-child{border-bottom:none}
#panel h2{font-size:9.5px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--text-dim);margin-bottom:8px}
.sel-name{font-size:15px;font-weight:600;color:var(--text-bright);line-height:1.35;min-height:20px}
.sel-desc{font-size:11px;color:var(--text-dim);line-height:1.5;margin-top:6px;min-height:16px}
.bcrumbs{display:flex;flex-wrap:wrap;gap:3px;align-items:center;margin-top:4px;min-height:14px}
.bcrumbs .crumb{font-size:10.5px;font-weight:500}
.bcrumbs .sep{font-size:10.5px;opacity:.3;margin:0 1px;color:var(--text-dim)}
.btn{background:transparent;border:1px solid var(--border);color:var(--text);font-family:inherit;font-size:11.5px;font-weight:500;padding:8px 11px;border-radius:7px;cursor:pointer;transition:all .15s;text-align:left;width:100%;margin-bottom:5px;display:block}
.btn:last-child{margin-bottom:0}
.btn:hover{background:var(--accent-dim);border-color:var(--accent);color:var(--accent)}
.tr{display:flex;align-items:center;gap:8px;padding:5px 0;cursor:pointer;user-select:none}
.tr:hover .tl{color:var(--text-bright)}
.chk{width:14px;height:14px;border-radius:3px;border:1.5px solid var(--text-dim);display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all .15s}
.chk svg{display:none}.tr.active .chk svg{display:block}
.tl{font-size:11.5px;color:var(--text);line-height:1.3}.tr.active .tl{color:var(--text-bright)}
.info-box{background:#f8fafc;border:1px solid rgba(0,0,0,0.08);border-radius:9px;padding:12px 13px;margin-bottom:8px}
.info-hdr{font-size:9.5px;font-weight:700;letter-spacing:1.8px;text-transform:uppercase;display:flex;align-items:center;gap:6px;margin-bottom:8px}
.info-hdr.cap{color:var(--cap)}.info-hdr.dom{color:var(--accent)}.info-hdr.proc{color:var(--proc)}
.info-items{font-size:11px;color:var(--text-dim);line-height:1.6}
.info-items b{color:var(--text-bright);font-weight:500}
.stat-row{display:flex;gap:8px;margin-bottom:4px}
.stat-box{flex:1;background:#f8fafc;border:1px solid rgba(0,0,0,0.08);border-radius:7px;padding:8px 10px;text-align:center}
.stat-val{font-size:18px;font-weight:600;color:var(--accent);line-height:1}
.stat-lbl{font-size:9px;color:var(--text-dim);text-transform:uppercase;letter-spacing:0.5px;margin-top:3px}
.node-group{cursor:pointer}
.node-group:hover .node-ellipse{filter:brightness(1.15)}
.node-ellipse{transition:fill .3s,stroke .3s,opacity .3s}
.node-label{fill:var(--text-bright);font-family:'DM Sans',sans-serif;text-anchor:middle;dominant-baseline:central;pointer-events:none;font-weight:600;transition:opacity .3s}
.edge{stroke-width:1.2;fill:none;opacity:.3}
.node-group.selected .node-ellipse{filter:drop-shadow(0 0 10px rgba(37,99,235,.35))}
.node-group.dimmed .node-ellipse{fill:#f8f9fa!important;stroke:#d1d5db!important;opacity:.35}
.node-group.dimmed .node-label{opacity:.2;fill:#a0aec0}
.edge.dimmed{opacity:.05}
.shared-edge{fill:none;stroke-dasharray:5 4;stroke-width:1.4;opacity:.4;cursor:pointer;transition:opacity .2s,stroke-width .2s}
.shared-edge:hover{opacity:1;stroke-width:2.2}
.shared-label{font-family:'DM Sans',sans-serif;font-size:7px;font-weight:500;pointer-events:none;fill:var(--text-dim)}
#tooltip{position:fixed;background:#fff;border:1px solid rgba(0,0,0,0.12);color:var(--text-bright);font-family:'DM Sans',sans-serif;font-size:12px;padding:10px 14px;border-radius:8px;pointer-events:none;opacity:0;transition:opacity .15s;z-index:200;max-width:380px;line-height:1.5;box-shadow:0 4px 24px rgba(0,0,0,.12)}
#tooltip.vis{opacity:1}
.ttw{font-size:10.5px;color:var(--text-dim);margin-top:2px}
.panel-hint{font-size:10px;color:var(--text-dim);line-height:1.65;padding:12px 16px}
.tr[data-dom="d1"].active .chk{background:var(--d1);border-color:var(--d1)}.tr[data-dom="d1"] .chk{border-color:var(--d1)}
.tr[data-dom="d2"].active .chk{background:var(--d2);border-color:var(--d2)}.tr[data-dom="d2"] .chk{border-color:var(--d2)}
.tr[data-dom="d3"].active .chk{background:var(--d3);border-color:var(--d3)}.tr[data-dom="d3"] .chk{border-color:var(--d3)}
.tr[data-dom="d4"].active .chk{background:var(--d4);border-color:var(--d4)}.tr[data-dom="d4"] .chk{border-color:var(--d4)}
.tr[data-dom="d5"].active .chk{background:var(--d5);border-color:var(--d5)}.tr[data-dom="d5"] .chk{border-color:var(--d5)}
.tr[data-dom="d6"].active .chk{background:var(--d6);border-color:var(--d6)}.tr[data-dom="d6"] .chk{border-color:var(--d6)}
.gen.active .chk{background:var(--cap);border-color:var(--cap)}
.p-qw.active .chk{background:var(--p-qw);border-color:var(--p-qw)}.p-qw .chk{border-color:var(--p-qw)}
.p-se.active .chk{background:var(--p-se);border-color:var(--p-se)}.p-se .chk{border-color:var(--p-se)}
.p-sf.active .chk{background:var(--p-sf);border-color:var(--p-sf)}.p-sf .chk{border-color:var(--p-sf)}
.prio-badge{display:inline-block;font-size:9px;font-weight:700;letter-spacing:.5px;padding:2px 7px;border-radius:4px;margin-top:4px}
.prio-badge.qw{background:var(--p-qwf);color:var(--p-qw);border:1px solid rgba(22,163,74,.2)}
.prio-badge.se{background:var(--p-sef);color:var(--p-se);border:1px solid rgba(37,99,235,.2)}
.prio-badge.sf{background:var(--p-sff);color:var(--p-sf);border:1px solid rgba(147,51,234,.2)}
</style>
</head>
<body>
<div id="canvas-wrap"><svg id="viz"></svg></div>
<div id="tooltip"><div id="tt-main"></div><div id="tt-w" class="ttw"></div></div>
<div id="panel">
<div class="ps">
  <h2>Vald nod</h2>
  <div class="sel-name" id="sel-name">â€”</div>
  <div class="bcrumbs" id="bcrumbs"><span style="color:var(--text-dim);font-size:11px">Klicka pÃ¥ en nod</span></div>
  <div class="sel-desc" id="sel-desc"></div>
</div>
<div class="ps" id="info-panel" style="display:none">
  <div class="stat-row" id="stat-row"></div>
  <div class="info-box" id="cap-box" style="display:none">
    <div class="info-hdr cap">ğŸ”§ PlattformsfÃ¶rmÃ¥gor</div>
    <div class="info-items" id="cap-info"></div>
  </div>
  <div class="info-box" id="dom-box" style="display:none">
    <div class="info-hdr dom">ğŸ“‹ Kontext</div>
    <div class="info-items" id="dom-info"></div>
  </div>
</div>
<div class="ps">
  <h2>DomÃ¤nfilter</h2>
  <div class="tr active" data-dom="d1"><span class="chk"><svg width="9" height="7" viewBox="0 0 9 7"><path d="M1 3.5L3 5.5L8 1" stroke="white" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" fill="none"/></svg></span><span class="tl">ğŸ¥ HÃ¤lso- och sjukvÃ¥rd</span></div>
  <div class="tr active" data-dom="d2"><span class="chk"><svg width="9" height="7" viewBox="0 0 9 7"><path d="M1 3.5L3 5.5L8 1" stroke="white" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" fill="none"/></svg></span><span class="tl">ğŸšŒ Kollektivtrafik</span></div>
  <div class="tr active" data-dom="d3"><span class="chk"><svg width="9" height="7" viewBox="0 0 9 7"><path d="M1 3.5L3 5.5L8 1" stroke="white" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" fill="none"/></svg></span><span class="tl">ğŸ¢ Fastighets- & lokalstrategi</span></div>
  <div class="tr active" data-dom="d4"><span class="chk"><svg width="9" height="7" viewBox="0 0 9 7"><path d="M1 3.5L3 5.5L8 1" stroke="white" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" fill="none"/></svg></span><span class="tl">ğŸŒ Regional utveckling</span></div>
  <div class="tr active" data-dom="d5"><span class="chk"><svg width="9" height="7" viewBox="0 0 9 7"><path d="M1 3.5L3 5.5L8 1" stroke="white" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" fill="none"/></svg></span><span class="tl">ğŸŒ¿ MiljÃ¶, klimat & hÃ¥llbarhet</span></div>
  <div class="tr active" data-dom="d6"><span class="chk"><svg width="9" height="7" viewBox="0 0 9 7"><path d="M1 3.5L3 5.5L8 1" stroke="white" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" fill="none"/></svg></span><span class="tl">ğŸ›¡ï¸ Beredskap & totalfÃ¶rsvar</span></div>
</div>
<div class="ps">
  <h2>Prioriteringsfilter</h2>
  <div class="tr p-qw active" data-prio="qw"><span class="chk"><svg width="9" height="7" viewBox="0 0 9 7"><path d="M1 3.5L3 5.5L8 1" stroke="white" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" fill="none"/></svg></span><span class="tl">âš¡ Quick win</span></div>
  <div class="tr p-se active" data-prio="se"><span class="chk"><svg width="9" height="7" viewBox="0 0 9 7"><path d="M1 3.5L3 5.5L8 1" stroke="white" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" fill="none"/></svg></span><span class="tl">ğŸ¯ Strategisk effekt</span></div>
  <div class="tr p-sf active" data-prio="sf"><span class="chk"><svg width="9" height="7" viewBox="0 0 9 7"><path d="M1 3.5L3 5.5L8 1" stroke="white" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" fill="none"/></svg></span><span class="tl">ğŸ”® SystemfÃ¶rÃ¤ndring</span></div>
</div>
<div class="ps">
  <h2>Delade fÃ¶rmÃ¥gor</h2>
  <div class="tr gen active" id="shared-toggle"><span class="chk"><svg width="9" height="7" viewBox="0 0 9 7"><path d="M1 3.5L3 5.5L8 1" stroke="white" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" fill="none"/></svg></span><span class="tl">TvÃ¤rdomÃ¤nkopplingar</span></div>
</div>
<div class="ps">
  <h2>Ã…tgÃ¤rder</h2>
  <button class="btn" id="btn-reset-exp">â†º Ã…terstÃ¤ll</button>
  <button class="btn" id="btn-reset-view">âŠ Passa vy</button>
  <button class="btn" id="btn-expand-all">âŠ• Expandera alla</button>
</div>
<div class="panel-hint">Scroll=zoom Â· Dra=panorera Â· Dubbelklick=passa<br>Klicka nod=expandera/kollapsa</div>
</div>

<script>
const CN={kartor:"Professionella kartor",analys:"Geografisk analys & datavetenskap",portaler:"Portaler & informationsprodukter",dashboards:"Dashboards & nulÃ¤gesbild",appar:"Mobila arbetsflÃ¶den",ruttning:"Ruttning & zonindelning",geokod:"Geokodning i X, Y, Z",bilder:"Stora mÃ¤ngder bilder",treD:"3D-visualisering & analys",ai:"AI-bildtolkning & video",iot:"IoT & realtidsdata",bigdata:"Big Data-analys",reality:"Reality capture",geodata:"Lagring & underhÃ¥ll geodata",cadbim:"CAD/BIM-integration",enterprise:"Enterprise-integration"};

// Helper: capability child node
function C(pid,idx,label,cap,desc){return{id:`${pid}c${idx}`,label,meta:{type:"cap",cap,desc}}}

const DATA={id:"root",label:"Sveriges\nRegioner",meta:{desc:"6 domÃ¤ner Â· 27 behov Â· 68 processer Â· 16 fÃ¶rmÃ¥gor"},children:[

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 1. HÃ„LSO- OCH SJUKVÃ…RD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
{id:"d1",label:"HÃ¤lso- och\nsjukvÃ¥rd",meta:{dom:"d1",count:"6 behov",desc:"Kapacitetsplanering, tillgÃ¤nglighet, ambulans, smittspridning, fastighetsbelastning, krisberedskap"},children:[

  {id:"d1b1",label:"Kapacitets-\nplanering",meta:{dom:"d1",desc:"Prognostisera och styra vÃ¥rdkapacitet geografiskt"},children:[
    {id:"d1b1p1",label:"BelÃ¤ggnings-\nkartlÃ¤ggning",meta:{dom:"d1",type:"proc",prio:"qw",desc:"KartlÃ¤gger belÃ¤ggningsgrad per vÃ¥rdenhet och upptagningsomrÃ¥de i realtid"},children:[
      C("d1b1p1",1,"Dashboards","dashboards","Realtidsvy Ã¶ver belÃ¤ggning per vÃ¥rdenhet â€” ledningen ser kapacitetslÃ¤get utan att ringa runt"),
      C("d1b1p1",2,"Geokodning","geokod","Kopplar patientdata till vÃ¥rdenhetens geografi â€” visar varifrÃ¥n patienterna kommer och var trycket Ã¤r stÃ¶rst"),
      C("d1b1p1",3,"Enterprise","enterprise","Integration med journalsystem â€” belÃ¤ggningsdata flÃ¶dar automatiskt in i kartan utan manuell hantering")
    ]},
    {id:"d1b1p2",label:"VÃ¥rdtrycks-\nprognos",meta:{dom:"d1",type:"proc",prio:"se",desc:"Modellerar framtida vÃ¥rdtryck baserat pÃ¥ demografi, sÃ¤song och historik"},children:[
      C("d1b1p2",1,"Analys","analys","Hotspot-analys och prediktiva modeller â€” identifierar var vÃ¥rdtrycket Ã¶kar innan flaskhalsarna uppstÃ¥r"),
      C("d1b1p2",2,"Big Data","bigdata","Analys av historiska patientflÃ¶den och sÃ¤songsmÃ¶nster â€” underlag fÃ¶r dimensionering och bemanning"),
      C("d1b1p2",3,"Dashboards","dashboards","Scenario-dashboard med prognoser per enhet â€” beslutsfattare kan simulera effekten av olika Ã¥tgÃ¤rder")
    ]}
  ]},

  {id:"d1b2",label:"TillgÃ¤nglighet\n& jÃ¤mlik vÃ¥rd",meta:{dom:"d1",desc:"Analysera och sÃ¤kerstÃ¤lla geografiskt jÃ¤mlik vÃ¥rdtillgÃ¥ng"},children:[
    {id:"d1b2p1",label:"Restids- och\ntÃ¤ckningsanalys",meta:{dom:"d1",type:"proc",prio:"qw",desc:"BerÃ¤knar hur lÃ¥ng tid invÃ¥nare har till nÃ¤rmaste vÃ¥rdenhet och identifierar vita flÃ¤ckar"},children:[
      C("d1b2p1",1,"Analys","analys","Restidsanalys som identifierar geografiska vÃ¥rdgap â€” visar var medborgare har orimligt lÃ¥ng vÃ¤g till vÃ¥rd"),
      C("d1b2p1",2,"Ruttning","ruttning","BerÃ¤knar restidszoner runt varje vÃ¥rdenhet â€” 30, 60 och 90 minuter med faktiska vÃ¤gnÃ¤tet"),
      C("d1b2p1",3,"Geokodning","geokod","Matchar befolkningsdata till vÃ¥rdutbud â€” kvantifierar exakt hur mÃ¥nga invÃ¥nare som nÃ¥s per tidszon")
    ]},
    {id:"d1b2p2",label:"Socioekonomisk\nvÃ¥rdgapsanalys",meta:{dom:"d1",type:"proc",prio:"se",desc:"Ã–verlagrar socioekonomiska data med vÃ¥rdtillgÃ¥ng fÃ¶r att avslÃ¶ja ojÃ¤mlikhet"},children:[
      C("d1b2p2",1,"Big Data","bigdata","Kombinerar SCB-data med vÃ¥rdutnyttjande â€” avslÃ¶jar om socioekonomisk status pÃ¥verkar tillgÃ¥ngen"),
      C("d1b2p2",2,"Portaler","portaler","Transparensportal med Ã¶ppna vÃ¥rdtÃ¤ckningskartor â€” stÃ¤rker demokratisk insyn och dialog med medborgare"),
      C("d1b2p2",3,"Kartor","kartor","Professionella beslutskartor till regionfullmÃ¤ktige â€” visar geografiska skillnader i vÃ¥rdtillgÃ¥ng")
    ]}
  ]},

  {id:"d1b3",label:"Ambulans-\noptimering",meta:{dom:"d1",desc:"Optimera responstider och stationering av prehospitala resurser"},children:[
    {id:"d1b3p1",label:"Dynamisk ruttning\nvid prio 1-larm",meta:{dom:"d1",type:"proc",prio:"se",desc:"BerÃ¤knar snabbaste vÃ¤g i realtid baserat pÃ¥ trafiklÃ¤ge vid akuta larm"},children:[
      C("d1b3p1",1,"Ruttning","ruttning","Dynamisk ruttoptimering med live-trafikdata â€” minimerar responstid genom att berÃ¤kna snabbaste vÃ¤g just nu"),
      C("d1b3p1",2,"IoT","iot","RealtidsspÃ¥rning av alla ambulanser â€” dirigerar nÃ¤rmaste lediga resurs automatiskt till larmplatsen"),
      C("d1b3p1",3,"Appar","appar","Mobil lÃ¤gesbild i fordonet â€” fÃ¶raren ser navigation, patientinfo och nÃ¤rmaste akutmottagning i samma vy")
    ]},
    {id:"d1b3p2",label:"Stationerings-\noptimering",meta:{dom:"d1",type:"proc",prio:"qw",desc:"Analyserar optimal placering av ambulansstationer baserat pÃ¥ larmhistorik och befolkning"},children:[
      C("d1b3p2",1,"Analys","analys","Geospatial optimering av stationsplacering â€” maximerar befolkningstÃ¤ckning inom 8 resp. 20 minuter"),
      C("d1b3p2",2,"Dashboards","dashboards","Live-dashboard med responstider och tÃ¤ckningsgrad â€” stÃ¶d fÃ¶r operativ och strategisk planering"),
      C("d1b3p2",3,"Big Data","bigdata","Historisk larmdata analyserad spatialt â€” avslÃ¶jar mÃ¶nster i var och nÃ¤r larm uppstÃ¥r per dygn och sÃ¤song")
    ]}
  ]},

  {id:"d1b4",label:"Smittspridnings-\nanalys",meta:{dom:"d1",desc:"Ã–vervaka och modellera smittspridning fÃ¶r tidiga, riktade insatser"},children:[
    {id:"d1b4p1",label:"Kluster- och\nutbrottsanalys",meta:{dom:"d1",type:"proc",prio:"se",desc:"Identifierar smitthÃ¤rdar och modellerar spridningsmÃ¶nster geografiskt"},children:[
      C("d1b4p1",1,"Analys","analys","Klusteranalys som identifierar smitthÃ¤rdar â€” ger underlag fÃ¶r riktade insatser till drabbade omrÃ¥den"),
      C("d1b4p1",2,"Geokodning","geokod","Geokodning av fall till omrÃ¥desnivÃ¥ â€” mÃ¶jliggÃ¶r spatial analys utan att exponera individdata"),
      C("d1b4p1",3,"Dashboards","dashboards","Epidemiologisk lÃ¤gesbild med kartor och trendkurvor â€” daglig uppfÃ¶ljning fÃ¶r smittskyddslÃ¤karen")
    ]},
    {id:"d1b4p2",label:"FolkhÃ¤lso-\nrapportering",meta:{dom:"d1",type:"proc",prio:"qw",desc:"Publicerar aktuell smittlÃ¤gesbild till samverkanspartners och allmÃ¤nhet"},children:[
      C("d1b4p2",1,"Portaler","portaler","FolkhÃ¤lsoportal som delar lÃ¤gesbild med kommuner och vÃ¥rdgivare â€” samordnar insatser Ã¶ver grÃ¤nser"),
      C("d1b4p2",2,"Big Data","bigdata","Trendanalys med historiska utbrottsmÃ¶nster â€” stÃ¶djer prediktiva modeller fÃ¶r framtida spridning"),
      C("d1b4p2",3,"Kartor","kartor","Smittklusterkartor fÃ¶r beslutsunderlag â€” visualiserar var insatser behÃ¶vs utan att peka ut individer")
    ]}
  ]},

  {id:"d1b5",label:"Fastighets-\nbelastning",meta:{dom:"d1",desc:"Ã–vervaka och optimera nyttjande av vÃ¥rdfastigheter"},children:[
    {id:"d1b5p1",label:"Digital tvilling\nvÃ¥rdfastigheter",meta:{dom:"d1",type:"proc",prio:"sf",desc:"3D-modell av hela fastighetsbestÃ¥ndet kopplad till driftdata och BIM"},children:[
      C("d1b5p1",1,"3D","treD","Digital tvilling per vÃ¥ningsplan â€” visualiserar nyttjandegrad, flÃ¶den och funktioner i tre dimensioner"),
      C("d1b5p1",2,"CAD/BIM","cadbim","SÃ¶mlÃ¶s BIM-integration â€” kopplar byggnadsritningar till driftdata fÃ¶r helhetsÃ¶verblick"),
      C("d1b5p1",3,"IoT","iot","Sensorer fÃ¶r temperatur, nÃ¤rvaro och energi â€” realtidsdata om faktisk belastning per rum och system")
    ]},
    {id:"d1b5p2",label:"Lokaleffekti-\nviseringsanalys",meta:{dom:"d1",type:"proc",prio:"qw",desc:"Identifierar underutnyttjade lokaler och mÃ¶jligheter till konsolidering"},children:[
      C("d1b5p2",1,"Dashboards","dashboards","Nyttjandegrads-dashboard â€” visar vilka lokaler som Ã¤r tomma och var konsolidering sparar resurser"),
      C("d1b5p2",2,"Analys","analys","Behovsanalys kopplat till demografi â€” prognostiserar vilka lokaler som behÃ¶vs om 5 och 10 Ã¥r"),
      C("d1b5p2",3,"Geodata","geodata","Central fastighetsdatabas â€” en enda kÃ¤lla till sanning fÃ¶r hela bestÃ¥ndet med avtal, yta och status")
    ]}
  ]},

  {id:"d1b6",label:"Kris-\nberedskap",meta:{dom:"d1",desc:"Krisledning och samverkan vid extraordinÃ¤ra hÃ¤ndelser"},children:[
    {id:"d1b6p1",label:"Operativ\nkrisledning",meta:{dom:"d1",type:"proc",prio:"se",desc:"Samlad lÃ¤gesbild och resursstyrning under pÃ¥gÃ¥ende kris"},children:[
      C("d1b6p1",1,"Dashboards","dashboards","Operativ krisdashboard â€” samlar resursstatus, pÃ¥verkade enheter och insatser i en gemensam vy"),
      C("d1b6p1",2,"Portaler","portaler","Samverkansportal med SOS och kommun â€” gemensam lÃ¤gesbild under pÃ¥gÃ¥ende kris"),
      C("d1b6p1",3,"Appar","appar","Mobilt beslutsstÃ¶d fÃ¶r fÃ¤ltpersonal â€” rapportera status och ta emot uppdrag direkt frÃ¥n hÃ¤ndelseplatsen")
    ]},
    {id:"d1b6p2",label:"Evakuering och\nresurslokalisering",meta:{dom:"d1",type:"proc",prio:"se",desc:"Planerar evakueringsvÃ¤gar och lokaliserar resurser i realtid"},children:[
      C("d1b6p2",1,"Ruttning","ruttning","Evakueringsrutter berÃ¤knade dynamiskt â€” baserat pÃ¥ vilka vÃ¤gar och anlÃ¤ggningar som Ã¤r pÃ¥verkade"),
      C("d1b6p2",2,"IoT","iot","Sensorer pÃ¥ kritisk infrastruktur â€” triggers vid elavbrott eller vattenlÃ¤ckor som pÃ¥verkar vÃ¥rden"),
      C("d1b6p2",3,"Geokodning","geokod","Resurslokalisering i realtid â€” visar var personal, material och reservlokaler finns geografiskt")
    ]}
  ]}
]},

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 2. KOLLEKTIVTRAFIK
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
{id:"d2",label:"Kollektiv-\ntrafik",meta:{dom:"d2",count:"5 behov",desc:"Linjeoptimering, klimatanpassning, resmÃ¶nster, robusthet och elektrifiering"},children:[

  {id:"d2b1",label:"Linje-\noptimering",meta:{dom:"d2",desc:"Optimera linjenÃ¤t och utbud utifrÃ¥n faktiskt resande"},children:[
    {id:"d2b1p1",label:"NÃ¤tverks- och\nbehovsanalys",meta:{dom:"d2",type:"proc",prio:"se",desc:"Analyserar hur vÃ¤l linjenÃ¤tet matchar faktisk efterfrÃ¥gan och demografisk utveckling"},children:[
      C("d2b1p1",1,"Analys","analys","ResmÃ¶nsteranalys som identifierar var linjenÃ¤tet under- eller Ã¶verfÃ¶rsÃ¶rjer â€” underlag fÃ¶r ny linjestruktur"),
      C("d2b1p1",2,"Ruttning","ruttning","BerÃ¤knar upptagningsomrÃ¥den per hÃ¥llplats â€” visar vilka stadsdelar som har god respektive dÃ¥lig nÃ¤ttÃ¤ckning"),
      C("d2b1p1",3,"Big Data","bigdata","Analys av biljettvalideringar och mobildata â€” avslÃ¶jar dolda resmÃ¶nster och underfÃ¶rsÃ¶rjda strÃ¥k")
    ]},
    {id:"d2b1p2",label:"Kapacitets-\nstyrning",meta:{dom:"d2",type:"proc",prio:"qw",desc:"Dimensionerar fordonsinsats och turintervall efter faktisk belastning"},children:[
      C("d2b1p2",1,"Dashboards","dashboards","BelÃ¤ggningsdashboard per linje och avgÃ¥ng â€” visar var kapaciteten behÃ¶ver Ã¶kas eller minskas"),
      C("d2b1p2",2,"Geodata","geodata","Central nÃ¤tverksdatabas med linjer, hÃ¥llplatser och infrastruktur â€” garanterar att alla arbetar mot samma data"),
      C("d2b1p2",3,"Enterprise","enterprise","Integration med biljett- och trafiksystem â€” GIS-data synkas med operativa planeringsverktyg")
    ]}
  ]},

  {id:"d2b2",label:"Klimatanpassning\nav infrastruktur",meta:{dom:"d2",desc:"Identifiera och hantera klimatrelaterade sÃ¥rbarheter i nÃ¤tet"},children:[
    {id:"d2b2p1",label:"SÃ¥rbarhets-\nanalys av nÃ¤t",meta:{dom:"d2",type:"proc",prio:"se",desc:"Identifierar vilka strÃ¤ckor och noder som Ã¤r mest utsatta vid extremvÃ¤der"},children:[
      C("d2b2p1",1,"Analys","analys","SÃ¥rbarhetsanalys mot Ã¶versvÃ¤mning, skred och extremvÃ¤rme â€” pekar ut kritiska punkter i nÃ¤tet"),
      C("d2b2p1",2,"Kartor","kartor","Riskkartor som Ã¶verlagrar klimatscenarier med linjenÃ¤tet â€” visuellt beslutsunderlag fÃ¶r investeringar"),
      C("d2b2p1",3,"IoT","iot","RealtidsvÃ¤der och sensorer vid utsatta punkter â€” triggers varning nÃ¤r vattennivÃ¥er nÃ¥r kritiska vÃ¤rden")
    ]},
    {id:"d2b2p2",label:"Beredskap vid\nstÃ¶rning",meta:{dom:"d2",type:"proc",prio:"se",desc:"FÃ¶rbereder alternativa rutter och omledningsplaner som kan aktiveras omedelbart"},children:[
      C("d2b2p2",1,"Ruttning","ruttning","FÃ¶rberÃ¤knade alternativa rutter per stÃ¶rningsscenario â€” aktiveras med ett klick vid hÃ¤ndelse"),
      C("d2b2p2",2,"Reality","reality","DrÃ¶narinspektion av broar och banvallar efter storm â€” snabb skadeinventering utan trafikstopp"),
      C("d2b2p2",3,"Dashboards","dashboards","Robusthetsdashboard som visar aktuell status per strÃ¤cka â€” operatÃ¶rer ser omedelbart vad som Ã¤r pÃ¥verkat")
    ]}
  ]},

  {id:"d2b3",label:"ResmÃ¶nster-\nanalys",meta:{dom:"d2",desc:"FÃ¶rstÃ¥ hur, var och nÃ¤r mÃ¤nniskor reser fÃ¶r bÃ¤ttre utbud"},children:[
    {id:"d2b3p1",label:"EfterfrÃ¥ge-\nmodellering",meta:{dom:"d2",type:"proc",prio:"sf",desc:"Predikterar framtida resande baserat pÃ¥ bostadsbyggande, arbetsplatser och trender"},children:[
      C("d2b3p1",1,"Big Data","bigdata","Miljontals biljettransaktioner och GPS-data â€” avslÃ¶jar hur resandet faktiskt ser ut, inte hur vi tror det ser ut"),
      C("d2b3p1",2,"AI","ai","Prediktiv modell som prognostiserar efterfrÃ¥gan vid nya bostadsomrÃ¥den â€” planerare slipper gissa"),
      C("d2b3p1",3,"Analys","analys","Tidsgeografisk analys â€” visar hur resmÃ¶nster varierar mellan morgon/kvÃ¤ll, vardag/helg, sommar/vinter")
    ]},
    {id:"d2b3p2",label:"ResenÃ¤rs-\nuppfÃ¶ljning",meta:{dom:"d2",type:"proc",prio:"qw",desc:"LÃ¶pande uppfÃ¶ljning av resandeutveckling per linje, zon och hÃ¥llplats"},children:[
      C("d2b3p2",1,"Dashboards","dashboards","Interaktivt dashboard dÃ¤r planerare filtrerar per linje, tid och dag â€” fÃ¶rstÃ¥r belastningsmÃ¶nster direkt"),
      C("d2b3p2",2,"Geokodning","geokod","Biljettdata kopplat till hÃ¥llplatser och zoner â€” mÃ¶jliggÃ¶r analys av intÃ¤kter och resande per omrÃ¥de"),
      C("d2b3p2",3,"Portaler","portaler","ResenÃ¤rsportal med realtidsinformation och tÃ¤ckningskartor â€” Ã¶kar kundnÃ¶jdhet och transparens")
    ]}
  ]},

  {id:"d2b4",label:"Robusthet vid\nstÃ¶rningar",meta:{dom:"d2",desc:"Hantera stÃ¶rningar i realtid med snabb omledning och information"},children:[
    {id:"d2b4p1",label:"Realtids-\ntrafikledning",meta:{dom:"d2",type:"proc",prio:"se",desc:"Operativ styrning av trafiken med live-positioner, incidenter och omledning"},children:[
      C("d2b4p1",1,"IoT","iot","RealtidsspÃ¥rning av alla fordon â€” sekundaktuell vy Ã¶ver var varje buss och tÃ¥g befinner sig"),
      C("d2b4p1",2,"Dashboards","dashboards","Live-trafikdashboard som aggregerar fordon, incidenter och fÃ¶rseningar â€” operatÃ¶rer agerar snabbt"),
      C("d2b4p1",3,"Ruttning","ruttning","Dynamisk omledning vid olyckor eller vÃ¤garbeten â€” berÃ¤knar alternativ rutt och kommunicerar till fÃ¶rare")
    ]},
    {id:"d2b4p2",label:"FÃ¤ltkommunikation\nvid incident",meta:{dom:"d2",type:"proc",prio:"qw",desc:"SÃ¤kerstÃ¤ller att fÃ¶rare och fÃ¤ltpersonal har rÃ¤tt information vid stÃ¶rning"},children:[
      C("d2b4p2",1,"Appar","appar","Mobil lÃ¤gesbild fÃ¶r fÃ¶rare â€” rapportera incident, ta emot omledning och se alternativa rutter i fÃ¤lt"),
      C("d2b4p2",2,"Enterprise","enterprise","Integration med trafikledningssystem â€” GIS-data flÃ¶dar sÃ¶mlÃ¶st in i befintliga operativa verktyg"),
      C("d2b4p2",3,"Kartor","kartor","StÃ¶rningskartor som uppdateras i realtid â€” ger alla aktÃ¶rer samma bild av lÃ¤get")
    ]}
  ]},

  {id:"d2b5",label:"Elektrifiering",meta:{dom:"d2",desc:"Planera Ã¶vergÃ¥ng till eldrift med laddinfrastruktur och kapacitetsanalys"},children:[
    {id:"d2b5p1",label:"Laddinfrastruktur-\nplanering",meta:{dom:"d2",type:"proc",prio:"se",desc:"Identifierar optimala platser fÃ¶r laddstationer baserat pÃ¥ linjestruktur och energitillgÃ¥ng"},children:[
      C("d2b5p1",1,"Analys","analys","Energibehovsanalys per linje baserat pÃ¥ topografi och strÃ¤cklÃ¤ngd â€” berÃ¤knar var laddstationer ger stÃ¶rst effekt"),
      C("d2b5p1",2,"3D","treD","3D-analys av depÃ¥er och elinfrastruktur â€” visualiserar kabeldragning och transformatorplacering"),
      C("d2b5p1",3,"CAD/BIM","cadbim","BIM-integration vid depÃ¥ombyggnation â€” kopplar projekteringsmodeller till geospatial nÃ¤tkapacitetsanalys")
    ]},
    {id:"d2b5p2",label:"Energi-\nÃ¶vervakning",meta:{dom:"d2",type:"proc",prio:"sf",desc:"RealtidsuppfÃ¶ljning av laddstatus, fÃ¶rbrukning och kapacitetsutnyttjande"},children:[
      C("d2b5p2",1,"IoT","iot","RealtidsÃ¶vervakning av laddstationer och batterier â€” optimerar laddscheman och identifierar kapacitetsrisker"),
      C("d2b5p2",2,"Dashboards","dashboards","EnergiflÃ¶desdashboard med laddstatus och fÃ¶rbrukning â€” beslutsstÃ¶d fÃ¶r elektrifieringsutbyggnad"),
      C("d2b5p2",3,"Enterprise","enterprise","Integration med energibolag och underhÃ¥llssystem â€” kopplar ladddata till elnÃ¤tets kapacitet")
    ]}
  ]}
]},

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 3. FASTIGHETS- OCH LOKALSTRATEGI
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
{id:"d3",label:"Fastighets- och\nlokalstrategi",meta:{dom:"d3",count:"4 behov",desc:"Energioptimering, klimatrisk, lokalfÃ¶rsÃ¶rjning och investeringar"},children:[

  {id:"d3b1",label:"Energi-\noptimering",meta:{dom:"d3",desc:"Minska energifÃ¶rbrukning i regionens fastighetsbestÃ¥nd"},children:[
    {id:"d3b1p1",label:"Energiprestanda-\nuppfÃ¶ljning",meta:{dom:"d3",type:"proc",prio:"se",desc:"LÃ¶pande Ã¶vervakning av energifÃ¶rbrukning med automatisk avvikelsedetektering"},children:[
      C("d3b1p1",1,"IoT","iot","RealtidsÃ¶vervakning per byggnad â€” identifierar avvikelser och triggers larm vid onormal fÃ¶rbrukning"),
      C("d3b1p1",2,"Dashboards","dashboards","Energidashboard per fastighet och portfÃ¶lj â€” jÃ¤mfÃ¶r byggnader och fÃ¶ljer upp mot energimÃ¥l"),
      C("d3b1p1",3,"Enterprise","enterprise","Integration med energisystem â€” fÃ¶rbrukningsdata flÃ¶dar automatiskt in utan manuell inmatning")
    ]},
    {id:"d3b1p2",label:"Ã…tgÃ¤rds-\nprioritering",meta:{dom:"d3",type:"proc",prio:"sf",desc:"Identifierar och rangordnar energiÃ¥tgÃ¤rder efter kostnad, effekt och klimatpÃ¥verkan"},children:[
      C("d3b1p2",1,"AI","ai","AI-analys av drÃ¶nartermografi â€” identifierar vÃ¤rmelÃ¤ckage automatiskt och pekar ut prioriterade byggnader"),
      C("d3b1p2",2,"3D","treD","3D-energisimulering per vÃ¥ning â€” visualiserar var vÃ¤rmefÃ¶rluster uppstÃ¥r och vilken effekt Ã¥tgÃ¤rder ger"),
      C("d3b1p2",3,"CAD/BIM","cadbim","BIM-koppling berikar analysen med byggnadsgeometri och material â€” mÃ¶jliggÃ¶r precisa berÃ¤kningar")
    ]}
  ]},

  {id:"d3b2",label:"Klimatrisk",meta:{dom:"d3",desc:"Identifiera och hantera klimatrelaterade risker mot fastighetsbestÃ¥ndet"},children:[
    {id:"d3b2p1",label:"SÃ¥rbarhets-\nbedÃ¶mning",meta:{dom:"d3",type:"proc",prio:"se",desc:"KartlÃ¤gger vilka fastigheter som ligger i riskzoner fÃ¶r Ã¶versvÃ¤mning, skred eller vÃ¤rme"},children:[
      C("d3b2p1",1,"Analys","analys","Ã–verlagrar klimatscenarier med fastighetsdata â€” identifierar vilka byggnader som Ã¤r i riskzoner"),
      C("d3b2p1",2,"3D","treD","3D-riskmodell som visualiserar vattennivÃ¥er mot byggnadsgeometri â€” intuitiv fÃ¶rstÃ¥else fÃ¶r sÃ¥rbarhet"),
      C("d3b2p1",3,"Bilder","bilder","Satellitbilder och historiska flygfoton â€” tidsserianalys av drÃ¤nering och vegetation runt fastigheter")
    ]},
    {id:"d3b2p2",label:"Skadeinventering\nefter hÃ¤ndelse",meta:{dom:"d3",type:"proc",prio:"sf",desc:"Snabb dokumentation av skador efter klimathÃ¤ndelse fÃ¶r Ã¥tgÃ¤rdsplanering"},children:[
      C("d3b2p2",1,"Reality","reality","DrÃ¶narkartering efter storm â€” bilder konverteras till punktmoln och ortomosaiker fÃ¶r skadeinventering"),
      C("d3b2p2",2,"IoT","iot","RealtidsvÃ¤der och grundvattensensorer â€” varnar automatiskt nÃ¤r nivÃ¥er nÃ¤rmar sig kritiska trÃ¶skelvÃ¤rden"),
      C("d3b2p2",3,"Appar","appar","Mobil felrapportering i fÃ¤lt â€” personal dokumenterar skador med foto och position direkt till systemet")
    ]}
  ]},

  {id:"d3b3",label:"LokalfÃ¶rsÃ¶rjnings-\nplanering",meta:{dom:"d3",desc:"Planera framtida lokalbehov baserat pÃ¥ demografi och verksamhetsutveckling"},children:[
    {id:"d3b3p1",label:"Behovs- och\nkapacitetsanalys",meta:{dom:"d3",type:"proc",prio:"qw",desc:"Prognostiserar framtida lokalbehov och jÃ¤mfÃ¶r med befintligt bestÃ¥nd"},children:[
      C("d3b3p1",1,"Analys","analys","Demografisk behovsanalys kopplad till lokalkapacitet â€” visar var Ã¶verskott och underskott uppstÃ¥r Ã¶ver tid"),
      C("d3b3p1",2,"3D","treD","3D-scenariomodellering av ombyggnation â€” visualiserar alternativ och deras pÃ¥verkan pÃ¥ kapacitet och flÃ¶den"),
      C("d3b3p1",3,"Dashboards","dashboards","Kapacitetsdashboard med nyttjandegrad och prognoser â€” strategiskt beslutsunderlag fÃ¶r lokalportfÃ¶ljen")
    ]},
    {id:"d3b3p2",label:"PortfÃ¶lj-\nfÃ¶rvaltning",meta:{dom:"d3",type:"proc",prio:"qw",desc:"Samordnar hela fastighetsbestÃ¥ndet med avtal, funktion och skick i en vy"},children:[
      C("d3b3p2",1,"Geodata","geodata","Central lokaldatabas med alla fastigheter, avtal och funktioner â€” en enda kÃ¤lla till sanning"),
      C("d3b3p2",2,"CAD/BIM","cadbim","Import av byggnadsmodeller â€” planerade fÃ¶rÃ¤ndringar kopplas till operativa kartan sÃ¶mlÃ¶st"),
      C("d3b3p2",3,"Portaler","portaler","Fastighetsportal dÃ¤r verksamheten ser tillgÃ¤ngliga lokaler â€” minskar dubbelarbete och tomma ytor")
    ]}
  ]},

  {id:"d3b4",label:"Investeringar",meta:{dom:"d3",desc:"BeslutsstÃ¶d fÃ¶r CAPEX-prioritering och investeringsuppfÃ¶ljning"},children:[
    {id:"d3b4p1",label:"Investerings-\nprioritering",meta:{dom:"d3",type:"proc",prio:"se",desc:"Rangordnar investeringar baserat pÃ¥ behov, skick, demografi och kostnad"},children:[
      C("d3b4p1",1,"Analys","analys","Scenario- och prognosanalys som vÃ¤ger demografisk utveckling mot fastigheternas skick"),
      C("d3b4p1",2,"3D","treD","3D-scenarier som visualiserar hur om- och nybyggnation pÃ¥verkar kapacitet â€” styrgrupper jÃ¤mfÃ¶r visuellt"),
      C("d3b4p1",3,"Kartor","kartor","Investeringskartor fÃ¶r politiska beslutsunderlag â€” visar var regionens pengar gÃ¶r stÃ¶rst nytta")
    ]},
    {id:"d3b4p2",label:"Projekt-\nuppfÃ¶ljning",meta:{dom:"d3",type:"proc",prio:"qw",desc:"FÃ¶ljer pÃ¥gÃ¥ende investeringar med budget, tidplan och status pÃ¥ karta"},children:[
      C("d3b4p2",1,"Dashboards","dashboards","CAPEX-dashboard med karta â€” planerade, pÃ¥gÃ¥ende och avslutade projekt med budget och tidplan"),
      C("d3b4p2",2,"Enterprise","enterprise","Integration med ekonomisystem â€” investerings-GIS kopplas till fakturor och projektredovisning"),
      C("d3b4p2",3,"Reality","reality","Reality capture-uppfÃ¶ljning med drÃ¶nare â€” dokumenterar byggprogress och jÃ¤mfÃ¶r med plan")
    ]}
  ]}
]},

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 4. REGIONAL UTVECKLING & SAMHÃ„LLSPLANERING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
{id:"d4",label:"Regional utveckling\n& samhÃ¤llsplanering",meta:{dom:"d4",count:"4 behov",desc:"NÃ¤ringslivsetableringar, infrastruktur, demografi och landsbygdsutveckling"},children:[

  {id:"d4b1",label:"NÃ¤ringslivs-\netableringar",meta:{dom:"d4",desc:"StÃ¶dja etableringsbeslut och synliggÃ¶ra regionens konkurrensfÃ¶rdelar"},children:[
    {id:"d4b1p1",label:"Etablerings-\nanalys",meta:{dom:"d4",type:"proc",prio:"se",desc:"Identifierar optimala lÃ¤gen fÃ¶r nya verksamheter baserat pÃ¥ tillgÃ¤nglighet, arbetskraft och marknad"},children:[
      C("d4b1p1",1,"Analys","analys","Plats- och konkurrensanalys â€” vÃ¤ger tillgÃ¤nglighet, arbetskraft och markpriser fÃ¶r optimalt etableringslÃ¤ge"),
      C("d4b1p1",2,"Big Data","bigdata","FÃ¶retags- och sysselsÃ¤ttningsdata pÃ¥ geografisk nivÃ¥ â€” avslÃ¶jar tillvÃ¤xttrender och branschstrukturer"),
      C("d4b1p1",3,"Geokodning","geokod","Geokodning av fÃ¶retagsdata â€” gÃ¶r nÃ¤ringslivsstrukturen spatial, inte bara tabeller")
    ]},
    {id:"d4b1p2",label:"Regionens\netableringsportal",meta:{dom:"d4",type:"proc",prio:"qw",desc:"Publikt skyltfÃ¶nster som visar lediga ytor, fÃ¶rutsÃ¤ttningar och klusterkartor"},children:[
      C("d4b1p2",1,"Portaler","portaler","NÃ¤ringslivsportal med lediga ytor och etableringsfÃ¶rutsÃ¤ttningar â€” regionens digitala skyltfÃ¶nster"),
      C("d4b1p2",2,"Dashboards","dashboards","Klusterdashboard med branschkoncentrationer och tillvÃ¤xt â€” helikopterperspektiv fÃ¶r regionledningen"),
      C("d4b1p2",3,"Kartor","kartor","Professionella etableringskartor â€” tryckt och digitalt material fÃ¶r nÃ¤ringslivsevent och investerardialoger")
    ]}
  ]},

  {id:"d4b2",label:"Infrastruktur-\nprioritering",meta:{dom:"d4",desc:"Underlag fÃ¶r lÃ¤nsplaner och strategiska infrastrukturinvesteringar"},children:[
    {id:"d4b2p1",label:"Kapacitets- och\nflaskhalsanalys",meta:{dom:"d4",type:"proc",prio:"se",desc:"Identifierar var infrastrukturen inte rÃ¤cker till och var investeringar ger stÃ¶rst effekt"},children:[
      C("d4b2p1",1,"Analys","analys","Trafik- och kapacitetsanalys som identifierar flaskhalsar â€” underlag fÃ¶r lÃ¤nsplaneprioritering"),
      C("d4b2p1",2,"Big Data","bigdata","Historisk trafikdata och pendlingsmÃ¶nster â€” visar var investeringar ger stÃ¶rst samhÃ¤llsekonomisk avkastning"),
      C("d4b2p1",3,"3D","treD","3D-korridormodellering fÃ¶r nya strÃ¤ckningar â€” visualiserar landskapspÃ¥verkan och markkonflikter")
    ]},
    {id:"d4b2p2",label:"Investerings-\nuppfÃ¶ljning",meta:{dom:"d4",type:"proc",prio:"qw",desc:"FÃ¶ljer alla infrastrukturprojekt med status, budget och tidplan pÃ¥ karta"},children:[
      C("d4b2p2",1,"Dashboards","dashboards","Investeringsdashboard med alla projekt pÃ¥ karta â€” status, budget och tidplan i en samordnad vy"),
      C("d4b2p2",2,"CAD/BIM","cadbim","BIM-stÃ¶d vid projektering â€” kopplar konstruktionsmodeller till geospatial kontext"),
      C("d4b2p2",3,"Enterprise","enterprise","Integration med Trafikverkets och kommunernas system â€” sÃ¶mlÃ¶s datadelning")
    ]}
  ]},

  {id:"d4b3",label:"Demografiska\nfÃ¶rÃ¤ndringar",meta:{dom:"d4",desc:"FÃ¶rstÃ¥ och prognostisera befolkningsfÃ¶rÃ¤ndringar pÃ¥ detaljerad geografisk nivÃ¥"},children:[
    {id:"d4b3p1",label:"Befolknings-\nprognos",meta:{dom:"d4",type:"proc",prio:"se",desc:"Modellerar befolkningsutveckling per delomrÃ¥de fÃ¶r att dimensionera framtida service"},children:[
      C("d4b3p1",1,"Analys","analys","Prognos- och segregationsanalys per delomrÃ¥de â€” visar var servicebehoven Ã¶kar eller minskar"),
      C("d4b3p1",2,"Big Data","bigdata","Socioekonomiska dataset med hundratusentals poster â€” utbildning, inkomst och Ã¥lder kopplat till geografi"),
      C("d4b3p1",3,"Geokodning","geokod","Geokodning av SCB-data â€” gÃ¶r statistik spatial och mÃ¶jliggÃ¶r grannskap-fÃ¶r-grannskap-analys")
    ]},
    {id:"d4b3p2",label:"Ã–ppen\nstatistikportal",meta:{dom:"d4",type:"proc",prio:"qw",desc:"Publicerar demografisk data till kommuner, forskare och allmÃ¤nhet"},children:[
      C("d4b3p2",1,"Portaler","portaler","Statistikportal som Ã¶ppnar demografisk data fÃ¶r alla â€” stÃ¤rker evidensbaserat beslutsfattande"),
      C("d4b3p2",2,"Dashboards","dashboards","Demografidashboard med interaktiva kartor â€” beslutsfattare utforskar trender utan bestÃ¤llda rapporter"),
      C("d4b3p2",3,"Kartor","kartor","Befolkningskartor till regionala utvecklingsstrategin â€” visualiserar mÃ¶nster fÃ¶r politisk dialog")
    ]}
  ]},

  {id:"d4b4",label:"Landsbygds-\nutveckling",meta:{dom:"d4",desc:"StÃ¤rka fÃ¶rutsÃ¤ttningarna fÃ¶r boende, service och nÃ¤ringsliv utanfÃ¶r tÃ¤torter"},children:[
    {id:"d4b4p1",label:"TillgÃ¤nglighets-\nanalys",meta:{dom:"d4",type:"proc",prio:"qw",desc:"MÃ¤ter avstÃ¥nd till service, jobb och utbildning frÃ¥n landsbygdsperspektiv"},children:[
      C("d4b4p1",1,"Analys","analys","TillgÃ¤nglighetsanalys som kvantifierar landsbygdens villkor â€” avstÃ¥nd till service, jobb och utbildning"),
      C("d4b4p1",2,"Ruttning","ruttning","Restidszoner och funktionella arbetsmarknadsregioner â€” visar var bredband, vÃ¤gar och kollektivtrafik behÃ¶ver stÃ¤rkas"),
      C("d4b4p1",3,"Kartor","kartor","Servicestrukturkartor med bredbandstÃ¤ckning och naturresurser â€” underlag fÃ¶r landsbygdspolitik")
    ]},
    {id:"d4b4p2",label:"GrÃ¶n infrastruktur\n& resurser",meta:{dom:"d4",type:"proc",prio:"se",desc:"KartlÃ¤gger naturresurser, turismvÃ¤rden och grÃ¶n infrastruktur som utvecklingstillgÃ¥ngar"},children:[
      C("d4b4p2",1,"Geodata","geodata","Regional geodatabas med mark- och vattenresurser â€” grunddata som alla landsbygdsanalyser vilar pÃ¥"),
      C("d4b4p2",2,"Portaler","portaler","Planeringsportal med naturvÃ¤rden, turism och lokala resurser â€” gemensam plattform fÃ¶r samverkan"),
      C("d4b4p2",3,"Bilder","bilder","Satellitarkiv fÃ¶r Ã¶vervakning av markanvÃ¤ndning â€” tidsserier som visar fÃ¶rÃ¤ndring i det rurala landskapet")
    ]}
  ]}
]},

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 5. MILJÃ–, KLIMAT OCH HÃ…LLBARHET
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
{id:"d5",label:"MiljÃ¶, klimat\n& hÃ¥llbarhet",meta:{dom:"d5",count:"4 behov",desc:"UtslÃ¤ppsanalys, naturvÃ¤rden, klimatanpassning och uppfÃ¶ljning mot mÃ¥l"},children:[

  {id:"d5b1",label:"UtslÃ¤pps-\nanalys",meta:{dom:"d5",desc:"KartlÃ¤gga och fÃ¶lja upp regionens klimatpÃ¥verkan"},children:[
    {id:"d5b1p1",label:"UtslÃ¤ppskart-\nlÃ¤ggning",meta:{dom:"d5",type:"proc",prio:"qw",desc:"Bryter ner regionens klimatpÃ¥verkan per kommun, bransch och transportslag"},children:[
      C("d5b1p1",1,"Analys","analys","Sektorsanalys per kommun och bransch â€” visar exakt var i regionen Ã¥tgÃ¤rderna biter mest"),
      C("d5b1p1",2,"Big Data","bigdata","Stora klimatdataset som kombinerar nationell statistik med lokala mÃ¤tningar â€” detaljerad utslÃ¤ppsbild"),
      C("d5b1p1",3,"Kartor","kartor","UtslÃ¤ppskartor per sektor och geografi â€” beslutsunderlag fÃ¶r klimatpolitik och kommunikation")
    ]},
    {id:"d5b1p2",label:"Klimatbudget-\nuppfÃ¶ljning",meta:{dom:"d5",type:"proc",prio:"se",desc:"FÃ¶ljer upp regionens utslÃ¤pp mot klimatbudget i realtid"},children:[
      C("d5b1p2",1,"Dashboards","dashboards","UtslÃ¤ppsdashboard med trendkurvor â€” fÃ¶ljer regionens klimatbudget mot uppsatta mÃ¥l i realtid"),
      C("d5b1p2",2,"AI","ai","AI-markklassning frÃ¥n satellitdata â€” identifierar automatiskt markanvÃ¤ndningsfÃ¶rÃ¤ndringar som pÃ¥verkar kolbudgeten"),
      C("d5b1p2",3,"Enterprise","enterprise","Integration med rapporteringssystem â€” automatiserar datainsamling fÃ¶r CSRD och nationella miljÃ¶mÃ¥l")
    ]}
  ]},

  {id:"d5b2",label:"NaturvÃ¤rden",meta:{dom:"d5",desc:"Inventera och skydda regionens ekologiska vÃ¤rden"},children:[
    {id:"d5b2p1",label:"Ekologisk\nkonnektivitetsanalys",meta:{dom:"d5",type:"proc",prio:"sf",desc:"Modellerar grÃ¶na korridorer mellan habitat och visar var fragmentering kan brytas"},children:[
      C("d5b2p1",1,"Analys","analys","Konnektivitetsmodellering som visar var naturvÃ¤rden kan stÃ¤rkas genom strategisk markanvÃ¤ndning"),
      C("d5b2p1",2,"AI","ai","AI-klassificering av naturtyper frÃ¥n fjÃ¤rranalysdata â€” automatiserar inventering som annars tar veckor"),
      C("d5b2p1",3,"Geodata","geodata","Central miljÃ¶databas med naturtyper och artfÃ¶rekomster â€” auktoritativ kÃ¤lla fÃ¶r grÃ¶nstrukturanalyser")
    ]},
    {id:"d5b2p2",label:"NaturvÃ¤rdes-\ninventering",meta:{dom:"d5",type:"proc",prio:"sf",desc:"KartlÃ¤ggning och Ã¶vervakning av skyddsvÃ¤rda naturomrÃ¥den med fjÃ¤rranalys"},children:[
      C("d5b2p2",1,"Bilder","bilder","Satellitarkiv fÃ¶r vegetationsÃ¶vervakning â€” tidsserianalys avslÃ¶jar hotade naturvÃ¤rden innan det Ã¤r fÃ¶r sent"),
      C("d5b2p2",2,"Reality","reality","DrÃ¶narkartering av skyddsvÃ¤rda omrÃ¥den â€” hÃ¶gupplÃ¶sta modeller fÃ¶r inventering och uppfÃ¶ljning"),
      C("d5b2p2",3,"Appar","appar","FÃ¤ltinventeringsapp â€” biologer registrerar arter, naturtyper och skyddsvÃ¤rden direkt med position och foto")
    ]}
  ]},

  {id:"d5b3",label:"Klimat-\nanpassning",meta:{dom:"d5",desc:"FÃ¶rbereda regionen fÃ¶r klimatfÃ¶rÃ¤ndringens konsekvenser"},children:[
    {id:"d5b3p1",label:"Regional\nriskmodellering",meta:{dom:"d5",type:"proc",prio:"se",desc:"Simulerar effekterna av skyfall, havsnivÃ¥hÃ¶jning och vÃ¤rmeÃ¶ar pÃ¥ samhÃ¤llsfunktioner"},children:[
      C("d5b3p1",1,"Analys","analys","SÃ¥rbarhetsanalys som Ã¶verlagrar klimatscenarier med samhÃ¤llsfunktioner â€” visar vad som Ã¤r mest exponerat"),
      C("d5b3p1",2,"3D","treD","3D-riskmodell med simulerad vattennivÃ¥hÃ¶jning och vÃ¤rmeÃ¶ar â€” intuitiv fÃ¶rstÃ¥else fÃ¶r framtida risker"),
      C("d5b3p1",3,"IoT","iot","RealtidsvÃ¤derdata och miljÃ¶sensorer â€” triggers vid extremvÃ¤rden kopplat till beredskapsplaner")
    ]},
    {id:"d5b3p2",label:"Skadeinventering\nefter hÃ¤ndelse",meta:{dom:"d5",type:"proc",prio:"sf",desc:"Snabb kartlÃ¤ggning av klimatrelaterade skador fÃ¶r Ã¥tgÃ¤rdsplanering"},children:[
      C("d5b3p2",1,"Reality","reality","DrÃ¶naruppdatering efter skyfall eller skred â€” bilddata konverteras till analyserbara modeller inom timmar"),
      C("d5b3p2",2,"Bilder","bilder","FÃ¶re- och efterbilder frÃ¥n satellit â€” dokumenterar fÃ¶rÃ¤ndring och stÃ¶djer skadereglering och planering"),
      C("d5b3p2",3,"Dashboards","dashboards","Klimatriskdashboard som samlar hÃ¤ndelser och skador â€” underlag fÃ¶r regional anpassningsstrategi")
    ]}
  ]},

  {id:"d5b4",label:"UppfÃ¶ljning\nmot mÃ¥l",meta:{dom:"d5",desc:"Systematisk uppfÃ¶ljning av miljÃ¶- och klimatmÃ¥l pÃ¥ regional nivÃ¥"},children:[
    {id:"d5b4p1",label:"KPI-uppfÃ¶ljning\noch rapportering",meta:{dom:"d5",type:"proc",prio:"qw",desc:"Automatiserad uppfÃ¶ljning av klimat- och miljÃ¶indikatorer med kartor och trendkurvor"},children:[
      C("d5b4p1",1,"Dashboards","dashboards","KPI-dashboard som visar framsteg mot miljÃ¶mÃ¥l â€” automatiserad uppfÃ¶ljning med kartor och trendkurvor"),
      C("d5b4p1",2,"Big Data","bigdata","Analys av lÃ¥ngtidsdata och trender â€” identifierar om insatserna ger effekt eller om kursen behÃ¶ver justeras"),
      C("d5b4p1",3,"Enterprise","enterprise","Integration med rapporteringssystem â€” automatiserar datainsamling och rapportgenerering fÃ¶r CSRD/ESG")
    ]},
    {id:"d5b4p2",label:"Transparent\nmÃ¥lredovisning",meta:{dom:"d5",type:"proc",prio:"qw",desc:"Ã–ppen redovisning av mÃ¥luppfyllnad till kommuner, nÃ¤ringsliv och allmÃ¤nhet"},children:[
      C("d5b4p2",1,"Portaler","portaler","UppfÃ¶ljningsportal som delar indikatorer med kommuner och allmÃ¤nhet â€” transparens och samordning"),
      C("d5b4p2",2,"Kartor","kartor","Indikatorkartor som visualiserar mÃ¥luppfyllnad per kommun â€” underlag fÃ¶r politisk dialog och Ã¥rsredovisning"),
      C("d5b4p2",3,"Geokodning","geokod","Kopplar miljÃ¶indikatorer till geografi â€” gÃ¶r det mÃ¶jligt att se exakt var mÃ¥len nÃ¥s och var de inte gÃ¶r det")
    ]}
  ]}
]},

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 6. BEREDSKAP OCH TOTALFÃ–RSVAR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
{id:"d6",label:"Beredskap &\ntotalfÃ¶rsvar",meta:{dom:"d6",count:"4 behov",desc:"Kritisk infrastruktur, resiliens, samordning och situationsbild"},children:[

  {id:"d6b1",label:"Kritisk\ninfrastruktur",meta:{dom:"d6",desc:"FÃ¶rstÃ¥ och hantera beroenden i samhÃ¤llsviktiga system"},children:[
    {id:"d6b1p1",label:"Beroendeanalys\noch kaskadeffekter",meta:{dom:"d6",type:"proc",prio:"sf",desc:"Modellerar hur bortfall i ett system sprider sig till andra â€” avslÃ¶jar dolda systemrisker"},children:[
      C("d6b1p1",1,"Analys","analys","NÃ¤tverks- och kaskadanalys â€” avslÃ¶jar dolda beroenden mellan el, vatten, tele och transport"),
      C("d6b1p1",2,"3D","treD","3D-modell av infrastrukturnÃ¤t â€” visualiserar beroenden och kritiska noder rumsligt"),
      C("d6b1p1",3,"AI","ai","AI-baserad sÃ¥rbarhetsanalys â€” identifierar mÃ¶nster i incidentdata och predikterar stÃ¶rningspunkter")
    ]},
    {id:"d6b1p2",label:"Infrastruktur-\nÃ¶vervakning",meta:{dom:"d6",type:"proc",prio:"se",desc:"LÃ¶pande realtidsstatus pÃ¥ samhÃ¤llskritiska system med automatisk varning"},children:[
      C("d6b1p2",1,"IoT","iot","Realtidsstatus pÃ¥ kritisk infrastruktur via sensorer â€” omedelbar varning vid driftstÃ¶rning"),
      C("d6b1p2",2,"Dashboards","dashboards","Beroendedashboard som visar status per system â€” operatÃ¶rer ser hela kedjan, inte bara sin del"),
      C("d6b1p2",3,"Geodata","geodata","Infrastrukturdatabas med alla samhÃ¤llsviktiga anlÃ¤ggningar â€” auktoritativt register fÃ¶r beredskapsplanering")
    ]}
  ]},

  {id:"d6b2",label:"Resiliens",meta:{dom:"d6",desc:"SÃ¤kerstÃ¤lla kontinuitet i samhÃ¤llsviktiga funktioner"},children:[
    {id:"d6b2p1",label:"Kontinuitets-\nplanering",meta:{dom:"d6",type:"proc",prio:"se",desc:"Identifierar alternativa driftplatser och reservplaner fÃ¶r varje samhÃ¤llsviktig funktion"},children:[
      C("d6b2p1",1,"Analys","analys","Kritikalitetsanalys som rangordnar samhÃ¤llsviktiga funktioner â€” vad mÃ¥ste upprÃ¤tthÃ¥llas fÃ¶rst?"),
      C("d6b2p1",2,"3D","treD","3D-beroendemodell som visualiserar hur funktioner hÃ¤nger ihop rumsligt â€” underlÃ¤ttar reservplanering"),
      C("d6b2p1",3,"Enterprise","enterprise","Integration med personalregister, lokaler och fordon â€” beredskapsdata alltid synkroniserad med verkligheten")
    ]},
    {id:"d6b2p2",label:"Samverkans-\nplattform",meta:{dom:"d6",type:"proc",prio:"qw",desc:"Delar beredskapsplaner, kontakter och resurser mellan region, kommun och stat"},children:[
      C("d6b2p2",1,"Portaler","portaler","Samverkansportal mellan region och kommuner â€” delar planer, kontakter och resurser i en gemensam miljÃ¶"),
      C("d6b2p2",2,"Dashboards","dashboards","Kontinuitetsdashboard med status fÃ¶r reservplaner och beredskapslÃ¤ge â€” samlad vy fÃ¶r beredskapssamordnaren"),
      C("d6b2p2",3,"Geodata","geodata","Central beredskapsdatabas â€” samlar resurser, skyddsrum, reservlokaler och kontakter geografiskt")
    ]}
  ]},

  {id:"d6b3",label:"Samordning",meta:{dom:"d6",desc:"Gemensam bild och koordinering mellan alla aktÃ¶rer vid kris"},children:[
    {id:"d6b3p1",label:"Gemensam\nlÃ¤gesbild",meta:{dom:"d6",type:"proc",prio:"qw",desc:"Aggregerar information frÃ¥n multipla aktÃ¶rer till en samsyn under kris"},children:[
      C("d6b3p1",1,"Dashboards","dashboards","Gemensam dashboard som samlar data frÃ¥n region, kommun och myndigheter â€” samsyn oavsett organisation"),
      C("d6b3p1",2,"Portaler","portaler","Krisportal fÃ¶r informationsdelning â€” alla aktÃ¶rer ser samma lÃ¤gesbild och uppdaterar i realtid"),
      C("d6b3p1",3,"Enterprise","enterprise","Integration med WIS, LUPP och Rakel â€” GIS-data flÃ¶dar in i befintliga samordningsverktyg utan dubbelarbete")
    ]},
    {id:"d6b3p2",label:"Evakuerings-\nplanering",meta:{dom:"d6",type:"proc",prio:"se",desc:"Modellerar evakueringsscenarier med ruttoptimering och kapacitetsberÃ¤kning"},children:[
      C("d6b3p2",1,"Ruttning","ruttning","Evakueringsrutter med kapacitetsberÃ¤kning â€” modellerar hur befolkning fÃ¶rflyttas sÃ¤kert vid olika scenarier"),
      C("d6b3p2",2,"Analys","analys","Scenarioanalys som simulerar olika krisfÃ¶rlopp â€” testar om evakueringsplanerna hÃ¥ller under stress"),
      C("d6b3p2",3,"Appar","appar","Mobil fÃ¤ltapp fÃ¶r personal under kris â€” rapportera position, status och bilder till centrala lÃ¤gesbilden")
    ]}
  ]},

  {id:"d6b4",label:"Situations-\nbild",meta:{dom:"d6",desc:"Operativ realtidsbild som samlar alla hÃ¤ndelser, resurser och pÃ¥verkan"},children:[
    {id:"d6b4p1",label:"Operativt\nkrisrum",meta:{dom:"d6",type:"proc",prio:"se",desc:"Den centrala vyn i regionens krisrum med hÃ¤ndelser, resurser och insatser i realtid"},children:[
      C("d6b4p1",1,"Dashboards","dashboards","Operativ realtidsdashboard â€” den centrala skÃ¤rmen i krisrummet med all information samlad"),
      C("d6b4p1",2,"IoT","iot","Sensordata frÃ¥n infrastruktur, vÃ¤der och trafik â€” bygger en levande situationsbild som uppdateras kontinuerligt"),
      C("d6b4p1",3,"AI","ai","AI-incidentdetektion frÃ¥n kameror och sensorer â€” varnar innan operatÃ¶ren hinner reagera manuellt")
    ]},
    {id:"d6b4p2",label:"FÃ¤lt- och\ndrÃ¶narstÃ¶d",meta:{dom:"d6",type:"proc",prio:"sf",desc:"Ger personal pÃ¥ plats tillgÃ¥ng till situationsbilden och snabb kartuppdatering via drÃ¶nare"},children:[
      C("d6b4p2",1,"Reality","reality","DrÃ¶narbilder konverteras till aktuella kartor och 3D-modeller direkt pÃ¥ plats â€” minuter istÃ¤llet fÃ¶r dagar"),
      C("d6b4p2",2,"Appar","appar","FÃ¤ltapp med hela situationsbilden â€” rapportera, fotografera och navigera med samma verktyg"),
      C("d6b4p2",3,"Kartor","kartor","Snabbpublicerade situationskartor frÃ¥n fÃ¤ltdata â€” delas omedelbart med alla aktÃ¶rer i samverkan")
    ]}
  ]}
]}
]};

// Cross-domain shared capabilities
const SHARED=[
  {from:"d1b6p1c1",to:"d6b4p1c1",label:"Krisdashboard"},
  {from:"d1b3p1c1",to:"d2b4p1c3",label:"Ruttoptimering"},
  {from:"d1b6p2c1",to:"d6b3p2c1",label:"Evakuering"},
  {from:"d3b1p1c1",to:"d2b5p2c1",label:"Energi-IoT"},
  {from:"d3b3p1c2",to:"d6b1p1c2",label:"3D-infrastruktur"},
  {from:"d1b5p1c1",to:"d3b3p1c2",label:"Digital tvilling"},
  {from:"d5b3p1c1",to:"d3b2p1c1",label:"Klimatriskanalys"},
  {from:"d4b3p1c1",to:"d1b1p2c1",label:"Demografisk prognos"},
  {from:"d5b2p1c2",to:"d6b1p1c3",label:"AI-bildtolkning"},
  {from:"d2b3p1c1",to:"d4b1p1c2",label:"MobilitetsmÃ¶nster"},
  {from:"d6b2p2c1",to:"d1b6p1c2",label:"Samverkansportal"},
  {from:"d5b3p2c1",to:"d2b2p2c2",label:"Reality capture"},
];

const DOM_COLORS={d1:{stroke:'var(--d1)',fill:'var(--d1f)'},d2:{stroke:'var(--d2)',fill:'var(--d2f)'},d3:{stroke:'var(--d3)',fill:'var(--d3f)'},d4:{stroke:'var(--d4)',fill:'var(--d4f)'},d5:{stroke:'var(--d5)',fill:'var(--d5f)'},d6:{stroke:'var(--d6)',fill:'var(--d6f)'}};

// VISUAL CONFIG â€” 5 depths: root, domain, need, process, capability
const DCFG=[
  {rx:82,ry:34,fs:12.5,arm:0},   // 0: root
  {rx:66,ry:26,fs:10.5,arm:225},  // 1: domain
  {rx:52,ry:20,fs:9.5,arm:175},   // 2: need
  {rx:48,ry:18,fs:8.5,arm:155},   // 3: process
  {rx:36,ry:14,fs:7.5,arm:120},   // 4: capability
];
function dcfg(d){return DCFG[Math.min(d,DCFG.length-1)]}

// STATE
let expandedIds=new Set(),selectedId=null;
const domVis={d1:true,d2:true,d3:true,d4:true,d5:true,d6:true};
let showShared=true;
const prioVis={qw:true,se:true,sf:true};
let nodeMap={};
let vb={x:-600,y:-500,w:1200,h:1000};

function enrich(n,p,d){n.depth=d;n.parent=p;n.x=0;n.y=0;nodeMap[n.id]=n;if(n.children)n.children.forEach(c=>enrich(c,n,d+1))}
enrich(DATA,null,0);

function getDom(id){const n=nodeMap[id];if(!n)return null;if(n.meta?.dom)return n.meta.dom;if(n.parent)return getDom(n.parent.id);return null}
function domColor(dom){return DOM_COLORS[dom]||{stroke:'var(--accent)',fill:'var(--accent-dim)'}}

function countV(n){if(!n.children||!expandedIds.has(n.id))return 1;return 1+n.children.reduce((s,c)=>s+countV(c),0)}
function layout(){DATA.x=0;DATA.y=0;if(expandedIds.has(DATA.id))ring(DATA,-Math.PI,Math.PI)}
function ring(parent,ss,se){
  if(!parent.children||!expandedIds.has(parent.id))return;
  const kids=parent.children,cd=parent.depth+1,dcc=dcfg(cd),dcp=dcfg(parent.depth),ts=se-ss;
  let arm=Math.max(dcc.arm,dcp.rx+dcc.rx+30);
  const ns=2*dcc.rx+14,ma=ns/arm;
  if(ma*kids.length>ts)arm=(ma*kids.length*arm)/ts;
  const wts=kids.map(c=>countV(c)),tw=wts.reduce((a,b)=>a+b,0);
  let arcs=wts.map(w=>Math.max((w/tw)*ts,ma));
  const as2=arcs.reduce((a,b)=>a+b,0);arcs=arcs.map(a=>a*(ts/as2));
  let ang=ss;
  kids.forEach((child,i)=>{const arc=arcs[i],mid=ang+arc/2;child.x=parent.x+arm*Math.cos(mid);child.y=parent.y+arm*Math.sin(mid);if(expandedIds.has(child.id)&&child.children)ring(child,ang,ang+arc);ang+=arc});
}
function collectV(n,out){out.push(n);if(n.children&&expandedIds.has(n.id))n.children.forEach(c=>collectV(c,out))}
function fitVB(){const vis=[];collectV(DATA,vis);if(vis.length<=1){vb={x:-600,y:-500,w:1200,h:1000};return}let x0=1e9,x1=-1e9,y0=1e9,y1=-1e9;vis.forEach(n=>{const c=dcfg(n.depth);x0=Math.min(x0,n.x-c.rx-25);x1=Math.max(x1,n.x+c.rx+25);y0=Math.min(y0,n.y-c.ry-25);y1=Math.max(y1,n.y+c.ry+25)});vb={x:x0-70,y:y0-70,w:x1-x0+140,h:y1-y0+140}}
function getPath(id){const ids=[];let n=nodeMap[id];while(n){ids.unshift(n.id);n=n.parent}return ids}
function toggleExp(id){const n=nodeMap[id];if(!n.children||!n.children.length)return;if(expandedIds.has(id))collSub(id);else expandedIds.add(id)}
function collSub(id){expandedIds.delete(id);const n=nodeMap[id];if(n.children)n.children.forEach(c=>collSub(c.id))}
function resetExp(){expandedIds.clear();selectedId=null;renderFit();updatePanel()}
function expandAll(){function expR(n){expandedIds.add(n.id);if(n.children)n.children.forEach(c=>expR(c))}expR(DATA);renderFit()}

const svg=document.getElementById('viz'),NS='http://www.w3.org/2000/svg';
function applyVB(){svg.setAttribute('viewBox',`${vb.x} ${vb.y} ${vb.w} ${vb.h}`)}
function render(){layout();draw()}
function renderFit(){layout();fitVB();draw()}

function draw(){
  svg.innerHTML='';
  const bg=document.createElementNS(NS,'rect');bg.setAttribute('x',-1e5);bg.setAttribute('y',-1e5);bg.setAttribute('width',2e5);bg.setAttribute('height',2e5);bg.setAttribute('fill','transparent');
  bg.addEventListener('click',()=>{selectedId=null;render();updatePanel()});svg.appendChild(bg);
  const vis=[];collectV(DATA,vis);const visSet=new Set(vis.map(n=>n.id));
  const anyFilter=Object.values(domVis).some(v=>!v);
  function getPrio(id){const n=nodeMap[id];if(!n)return null;if(n.meta?.prio)return n.meta.prio;if(n.parent)return getPrio(n.parent.id);return null}
  function prioColor(p){return p==='qw'?'var(--p-qw)':p==='se'?'var(--p-se)':p==='sf'?'var(--p-sf)':null}
  const anyPrioFilter=!prioVis.qw||!prioVis.se||!prioVis.sf;
  function isDimmed(node){
    const d=getDom(node.id);
    const domDim=anyFilter&&d?!domVis[d]:false;
    const p=getPrio(node.id);
    const prioDim=anyPrioFilter&&p?!prioVis[p]:false;
    return domDim||prioDim;
  }

  // Edges
  vis.forEach(node=>{if(!node.parent||!visSet.has(node.parent.id))return;const ln=document.createElementNS(NS,'line');ln.setAttribute('x1',node.parent.x);ln.setAttribute('y1',node.parent.y);ln.setAttribute('x2',node.x);ln.setAttribute('y2',node.y);const dc=domColor(getDom(node.id));ln.setAttribute('stroke',dc.stroke);ln.setAttribute('class','edge'+(isDimmed(node)?' dimmed':''));svg.appendChild(ln)});

  // Shared edges
  if(showShared){SHARED.forEach(dep=>{if(!visSet.has(dep.from)||!visSet.has(dep.to))return;const A=nodeMap[dep.from],B=nodeMap[dep.to];const mx=(A.x+B.x)/2,my=(A.y+B.y)/2,dx=B.x-A.x,dy=B.y-A.y,len=Math.sqrt(dx*dx+dy*dy)||1,cv=Math.min(len*0.3,90),cpx=mx-dy/len*cv,cpy=my+dx/len*cv;const path=document.createElementNS(NS,'path');path.setAttribute('d',`M${A.x},${A.y} Q${cpx},${cpy} ${B.x},${B.y}`);path.setAttribute('class','shared-edge');path.setAttribute('stroke','var(--cap)');path.addEventListener('mouseenter',e=>{document.getElementById('tt-main').textContent=dep.label;document.getElementById('tt-w').textContent=`${nodeMap[dep.from]?.label.replace(/\n/g,' ')} â†” ${nodeMap[dep.to]?.label.replace(/\n/g,' ')}`;tt.classList.add('vis');moveTT(e)});path.addEventListener('mousemove',e=>moveTT(e));path.addEventListener('mouseleave',()=>tt.classList.remove('vis'));svg.appendChild(path);const t=.5,lx=(1-t)*(1-t)*A.x+2*(1-t)*t*cpx+t*t*B.x,ly=(1-t)*(1-t)*A.y+2*(1-t)*t*cpy+t*t*B.y;const lbl=document.createElementNS(NS,'text');lbl.setAttribute('x',lx);lbl.setAttribute('y',ly);lbl.setAttribute('class','shared-label');lbl.setAttribute('text-anchor','middle');lbl.textContent=dep.label;svg.appendChild(lbl)})}

  // Nodes
  vis.forEach(node=>{
    const cfg=dcfg(node.depth),dim=isDimmed(node),sel=node.id===selectedId,dom=getDom(node.id),dc=domColor(dom);
    const isCap=node.meta?.type==='cap',isProc=node.meta?.type==='proc';
    const g=document.createElementNS(NS,'g');g.setAttribute('class','node-group'+(sel?' selected':'')+(dim?' dimmed':''));g.dataset.id=node.id;
    const el=document.createElementNS(NS,'ellipse');el.setAttribute('cx',node.x);el.setAttribute('cy',node.y);el.setAttribute('rx',cfg.rx);el.setAttribute('ry',cfg.ry);
    let stroke=dc.stroke||'var(--accent)',fill=dc.fill||'var(--accent-dim)';
    if(node.depth===0){stroke='var(--accent)';fill='var(--accent-dim)'}
    if(isProc){
      const pr=node.meta?.prio;
      if(pr==='qw'){stroke='var(--p-qw)';fill='var(--p-qwf)'}
      else if(pr==='se'){stroke='var(--p-se)';fill='var(--p-sef)'}
      else if(pr==='sf'){stroke='var(--p-sf)';fill='var(--p-sff)'}
      else{stroke='var(--proc)';fill='var(--procf)'}
    }
    if(isCap){stroke='var(--cap)';fill='var(--capf)'}
    el.setAttribute('fill',fill);el.setAttribute('stroke',stroke);el.setAttribute('stroke-width',sel?2.8:1.5);el.setAttribute('class','node-ellipse');g.appendChild(el);
    if(node.children&&node.children.length){const dot=document.createElementNS(NS,'circle');dot.setAttribute('cx',node.x+cfg.rx-5);dot.setAttribute('cy',node.y-cfg.ry+5);dot.setAttribute('r',2.5);dot.setAttribute('fill',expandedIds.has(node.id)?stroke:'transparent');dot.setAttribute('stroke',stroke);dot.setAttribute('stroke-width','1');dot.setAttribute('opacity','0.8');g.appendChild(dot)}
    const fs=cfg.fs,lines=node.label.split('\n');const txt=document.createElementNS(NS,'text');txt.setAttribute('class','node-label');txt.setAttribute('font-size',fs);
    if(isCap)txt.setAttribute('fill','var(--cap)');if(isProc){const pr=node.meta?.prio;txt.setAttribute('fill',pr==='qw'?'var(--p-qw)':pr==='se'?'var(--p-se)':pr==='sf'?'var(--p-sf)':'var(--proc)');}
    const lh=fs*1.25,th=lines.length*lh,sy=node.y-th/2+lh/2;
    lines.forEach((l,li)=>{const ts=document.createElementNS(NS,'tspan');ts.setAttribute('x',node.x);ts.setAttribute('y',sy+li*lh);ts.textContent=l;txt.appendChild(ts)});g.appendChild(txt);

    g.addEventListener('mouseenter',e=>{const m=node.meta||{};let main=node.label.replace(/\n/g,' '),sub='';if(isCap&&m.cap){main=CN[m.cap]||main;sub=m.desc||'PlattformsfÃ¶rmÃ¥ga'}
      else if(isProc&&m.prio){const pl={qw:'âš¡ Quick win',se:'ğŸ¯ Strategisk effekt',sf:'ğŸ”® SystemfÃ¶rÃ¤ndring'};sub=(m.desc||'')+' â€” '+pl[m.prio]}
      else if(m.desc){sub=m.desc}else if(m.count){sub=m.count}document.getElementById('tt-main').textContent=main;document.getElementById('tt-w').textContent=sub;tt.classList.add('vis');moveTT(e)});
    g.addEventListener('mousemove',e=>moveTT(e));g.addEventListener('mouseleave',()=>tt.classList.remove('vis'));
    g.addEventListener('click',onNode);svg.appendChild(g);
  });

  if(selectedId&&visSet.has(selectedId)){const sn=nodeMap[selectedId];const ring=document.createElementNS(NS,'circle');ring.setAttribute('cx',sn.x);ring.setAttribute('cy',sn.y);ring.setAttribute('r','4');const m=nodeMap[selectedId].meta;ring.setAttribute('stroke',m?.type==='cap'?'var(--cap)':m?.type==='proc'?(m?.prio==='qw'?'var(--p-qw)':m?.prio==='se'?'var(--p-se)':m?.prio==='sf'?'var(--p-sf)':'var(--proc)'):domColor(getDom(selectedId)).stroke);ring.setAttribute('class','pulse-ring');svg.appendChild(ring)}
  applyVB();
}

const tt=document.getElementById('tooltip');
function moveTT(e){tt.style.left=(e.clientX+14)+'px';tt.style.top=(e.clientY-10)+'px'}

function onNode(e){e.stopPropagation();const id=e.currentTarget.dataset.id;selectedId=id;toggleExp(id);if(expandedIds.has(id))renderFit();else render();updatePanel()}

function updatePanel(){
  const nm=document.getElementById('sel-name'),bc=document.getElementById('bcrumbs'),desc=document.getElementById('sel-desc');
  const infoPanel=document.getElementById('info-panel'),capBox=document.getElementById('cap-box'),domBox=document.getElementById('dom-box'),statRow=document.getElementById('stat-row');
  if(!selectedId){nm.textContent='â€”';bc.innerHTML='<span style="color:var(--text-dim);font-size:11px">Klicka pÃ¥ en nod</span>';desc.textContent='';infoPanel.style.display='none';return}
  const node=nodeMap[selectedId];nm.textContent=node.label.replace(/\n/g,' ');
  const path=getPath(selectedId);
  bc.innerHTML=path.map((pid,i)=>{const n=nodeMap[pid],m=n.meta;const col=m?.type==='cap'?'var(--cap)':m?.type==='proc'?(m?.prio==='qw'?'var(--p-qw)':m?.prio==='se'?'var(--p-se)':m?.prio==='sf'?'var(--p-sf)':'var(--proc)'):domColor(getDom(pid)).stroke;return`<span class="crumb" style="color:${col}">${n.label.replace(/\n/g,' ')}</span>`+(i<path.length-1?'<span class="sep">â€º</span>':'')}).join('');
  const m=node.meta||{};

  if(m.type==='cap'&&m.cap){
    desc.textContent=m.desc||'';infoPanel.style.display='block';statRow.innerHTML='';
    let cnt=0;const usedIn=[];
    function sc(n){if(n.meta?.type==='cap'&&n.meta.cap===m.cap&&n.id!==selectedId){cnt++;if(n.parent)usedIn.push(n.parent.label.replace(/\n/g,' '))}if(n.children)n.children.forEach(c=>sc(c))}sc(DATA);
    statRow.innerHTML=`<div class="stat-box"><div class="stat-val">${cnt+1}</div><div class="stat-lbl">Processer</div></div>`;
    capBox.style.display='block';let h=`<b>${CN[m.cap]}</b><br><br><b style="color:var(--text)">I denna process:</b><br>${m.desc}`;
    if(usedIn.length>0){h+='<br><br><b style="color:var(--text)">Ã„ven i:</b>';usedIn.slice(0,8).forEach(u=>{h+=`<br>â€¢ ${u}`})}
    document.getElementById('cap-info').innerHTML=h;domBox.style.display='none';
  }else if(m.type==='proc'){
    const prioLabels={qw:'âš¡ Quick win',se:'ğŸ¯ Strategisk effekt',sf:'ğŸ”® SystemfÃ¶rÃ¤ndring'};
    const prioCls={qw:'qw',se:'se',sf:'sf'};
    desc.innerHTML=(m.desc||'')+(m.prio?'<br><span class="prio-badge '+prioCls[m.prio]+'">'+prioLabels[m.prio]+'</span>':'');
    infoPanel.style.display='block';
    const caps=node.children?node.children.filter(c=>c.meta?.type==='cap'):[];
    statRow.innerHTML=`<div class="stat-box"><div class="stat-val">${caps.length}</div><div class="stat-lbl">FÃ¶rmÃ¥gor</div></div>`;
    capBox.style.display='block';let h='';
    caps.forEach(c=>{h+=`<div style="margin-bottom:8px"><b>${CN[c.meta.cap]||c.label.replace(/\n/g,' ')}</b><br><span style="font-size:10.5px">${c.meta.desc||''}</span></div>`});
    document.getElementById('cap-info').innerHTML=h;domBox.style.display='none';
  }else if(node.depth===2){
    desc.textContent=m.desc||'';infoPanel.style.display='block';
    const procs=node.children?node.children.filter(c=>c.meta?.type==='proc'):[];
    const qwc=procs.filter(p=>p.meta.prio==='qw').length,sec=procs.filter(p=>p.meta.prio==='se').length,sfc=procs.filter(p=>p.meta.prio==='sf').length;
    statRow.innerHTML=`<div class="stat-box"><div class="stat-val" style="color:var(--p-qw)">${qwc}</div><div class="stat-lbl">Quick win</div></div><div class="stat-box"><div class="stat-val" style="color:var(--p-se)">${sec}</div><div class="stat-lbl">Strategisk</div></div><div class="stat-box"><div class="stat-val" style="color:var(--p-sf)">${sfc}</div><div class="stat-lbl">System</div></div>`;
    capBox.style.display='none';domBox.style.display='block';
    const prioLabelsN={qw:'âš¡ Quick win',se:'ğŸ¯ Strategisk effekt',sf:'ğŸ”® SystemfÃ¶rÃ¤ndring'};
    const prioCN={qw:'qw',se:'se',sf:'sf'};
    let h='<b style="color:var(--text)">Kritiska processer:</b><br>';
    procs.forEach(p=>{h+=`<div style="margin:6px 0"><b>${p.label.replace(/\n/g,' ')}</b>${p.meta.prio?'&ensp;<span class="prio-badge '+prioCN[p.meta.prio]+'">'+prioLabelsN[p.meta.prio]+'</span>':''}<br><span style="font-size:10.5px">${p.meta.desc||''}</span></div>`});
    document.getElementById('dom-info').innerHTML=h;
  }else if(node.depth===1){
    desc.textContent=m.desc||'';infoPanel.style.display='block';
    const needs=node.children||[];let procCount=0,capCount=0;
    needs.forEach(b=>{if(b.children)b.children.forEach(p=>{if(p.meta?.type==='proc'){procCount++;if(p.children)capCount+=p.children.length}})});
    statRow.innerHTML=`<div class="stat-box"><div class="stat-val">${needs.length}</div><div class="stat-lbl">Behov</div></div><div class="stat-box"><div class="stat-val">${procCount}</div><div class="stat-lbl">Processer</div></div><div class="stat-box"><div class="stat-val">${capCount}</div><div class="stat-lbl">FÃ¶rmÃ¥gor</div></div>`;
    capBox.style.display='none';domBox.style.display='block';document.getElementById('dom-info').innerHTML=m.desc||'';
  }else{
    desc.textContent=m.desc||'';infoPanel.style.display='block';
    statRow.innerHTML=`<div class="stat-box"><div class="stat-val" style="color:var(--p-qw)">22</div><div class="stat-lbl">Quick wins</div></div><div class="stat-box"><div class="stat-val" style="color:var(--p-se)">24</div><div class="stat-lbl">Strategiska</div></div><div class="stat-box"><div class="stat-val" style="color:var(--p-sf)">12</div><div class="stat-lbl">System</div></div>`;
    capBox.style.display='none';domBox.style.display='none';
  }
}

document.querySelectorAll('[data-dom]').forEach(el=>{el.addEventListener('click',function(){const d=this.dataset.dom;domVis[d]=!domVis[d];this.classList.toggle('active',domVis[d]);render()})});
document.querySelectorAll('[data-prio]').forEach(el=>{el.addEventListener('click',function(){const p=this.dataset.prio;prioVis[p]=!prioVis[p];this.classList.toggle('active',prioVis[p]);render()})});
document.getElementById('shared-toggle').addEventListener('click',function(){showShared=!showShared;this.classList.toggle('active',showShared);render()});
const wrap=document.getElementById('canvas-wrap');let isPan=false,panS={x:0,y:0};
wrap.addEventListener('mousedown',e=>{if(e.button!==0)return;isPan=true;panS={x:e.clientX,y:e.clientY};wrap.classList.add('dragging')});
window.addEventListener('mousemove',e=>{if(!isPan)return;const dx=e.clientX-panS.x,dy=e.clientY-panS.y;panS={x:e.clientX,y:e.clientY};const r=svg.getBoundingClientRect();vb.x-=dx*(vb.w/r.width);vb.y-=dy*(vb.h/r.height);applyVB()});
window.addEventListener('mouseup',()=>{isPan=false;wrap.classList.remove('dragging')});
wrap.addEventListener('wheel',e=>{e.preventDefault();const f=e.deltaY>0?1.09:1/1.09;const r=svg.getBoundingClientRect();const mx=vb.x+((e.clientX-r.left)/r.width)*vb.w;const my=vb.y+((e.clientY-r.top)/r.height)*vb.h;vb.x=mx-(mx-vb.x)*f;vb.y=my-(my-vb.y)*f;vb.w*=f;vb.h*=f;applyVB()},{passive:false});
wrap.addEventListener('dblclick',e=>{e.preventDefault();fitVB();applyVB()});
document.getElementById('btn-reset-exp').addEventListener('click',resetExp);
document.getElementById('btn-reset-view').addEventListener('click',()=>{fitVB();applyVB()});
document.getElementById('btn-expand-all').addEventListener('click',expandAll);

expandedIds.add('root');renderFit();updatePanel();
</script>
</body>
</html>
